var switch_subject_uri_form = function (format_value, cmps_id) {
    $.getScript("/change_subject_format_form/" + format_value + "/" + cmps_id);
};

var switch_object_form = function (format_value, property_bridge_id) {
    $.getScript("/change_object_value_form/" + property_bridge_id + '/' + format_value);
};

var bind_subject_uri_format_btn = function () {
    $(".subject-uri-format").unbind("click");
    $(".subject-uri-format").bind("click", function () {
        var selected_value = $(this).val();
        var cmps_id = $(this).data("cmpsid");
        switch_subject_uri_form(selected_value, cmps_id);
    });
};

var bind_add_subject_rdf_type_btn = function () {
    $("#add-class-btn").unbind("click");
    $("#add-class-btn").bind("click", function () {
        var html = "<%= j render(partial: 'subject_rdf_type_form', locals: { rdf_type_cmps: nil, first: false }) %>";
        $("#subject-rdf-type-wrapper").append(html);
        bind_del_subject_rdf_type_btn();
    });
};

var bind_del_subject_rdf_type_btn = function () {
    $(".subject-del-rdf-type-btn").unbind("click");
    $(".subject-del-rdf-type-btn").bind("click", function () {
        $(this).closest("div.form-group").remove();
    });
};

var bind_rdf_btn = function () {
    $(".btn-rdf").unbind("click");
    $(".btn-rdf").bind("click", function () {
        var elem_id = $(this).attr("id");
        var property_bridge_id = elem_id.substring("column-rdf-btn-".length);
        var enable_elem = $("#column-rdf-enable-" + property_bridge_id);

        if (enable_elem.val() == "true") {
            enable_elem.val("false");
            $(this).removeClass("btn-primary btn-rdf-disable");
            $(this).addClass("btn-default btn-rdf-enable");
            $("#column-listitem-" + property_bridge_id).addClass("disabled");
        } else {
            enable_elem.val("true");
            $(this).removeClass("btn-default btn-rdf-enable");
            $(this).addClass("btn-primary btn-rdf-disable");
            $("#column-listitem-" + property_bridge_id).removeClass("disabled");
        }
    });
};

var bind_add_property_bridge_btn = function () {
    $(".add-property-bridge-btn").unbind("click");
    $(".add-property-bridge-btn").bind("click", function () {
        var li = $(this).closest("li");
        var property_bridge_id = li.attr("data-pbid");

        $.get("/ajax/new_property_bridge_form", {
                class_map_id: "<%= @class_map.id %>",
                property_bridge_id: property_bridge_id
            },
            function (html) {
                li.after(html);
                $('.collapse').collapse();
                bind_object_format_btn();
                bind_rdf_btn();
                bind_del_property_bridge_btn();
                bind_add_predicate_btn();
                $('[data-toggle="tooltip"]').tooltip();
            }
        );
    });
};

var bind_del_property_bridge_btn = function () {
    $(".del-property-bridge-btn").unbind("click");
    $(".del-property-bridge-btn").bind("click", function () {
        var property_bridge_id = $(this).attr("data-pbid");
        $.get("/ajax/del_property_bridge_form", {property_bridge_id: property_bridge_id},
            function (data) {
                $("li#column-listitem-" + property_bridge_id).remove();
            }
        );
    });
};

var bind_add_predicate_btn = function () {
    $(".add-predicate-btn").unbind("click");
    $(".add-predicate-btn").bind("click", function () {
        var property_bridge_id = $(this).attr("data-pbid");
        $.get("/ajax/new_predicate_form", {property_bridge_id: property_bridge_id},
            function (html) {
                $("#predicate-wrapper-" + property_bridge_id).append(html);
                bind_del_predicate_btn();
            }
        );
    });
};

var bind_del_predicate_btn = function () {
    $(".predicate-del-btn").unbind("click");
    $(".predicate-del-btn").bind("click", function () {
        $(this).closest("div.form-group").remove();
    });
};

var bind_object_format_btn = function () {
    $(".object-format").unbind("click");
    $(".object-format").bind("click", function () {
        var selected_value = $(this).val();
        var property_bridge_id = $(this).attr("data-pbid");
        switch_object_form(selected_value, property_bridge_id);
    });
};

$(function () {
    $('[data-toggle="tooltip"]').tooltip();
    $('.collapse').collapse();

    <%#= render partial: 'table_selector_handler' %>

    bind_subject_uri_format_btn();
    bind_add_subject_rdf_type_btn();
    bind_del_subject_rdf_type_btn();
    bind_rdf_btn();
    bind_add_property_bridge_btn();
    bind_del_property_bridge_btn();
    bind_add_predicate_btn();
    bind_del_predicate_btn();
    bind_object_format_btn();
});
